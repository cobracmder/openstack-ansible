---
- name: Install horizon
  hosts: dashboard
  sudo: True
  gather_facts: True
  vars:
    component: dashboard
    packages:
      - memcached
      - python-memcached
      - mod_wsgi
      - "openstack-{{ component }}"
    services:
      - httpd
      - memcached
  tasks:

    - name: ensure {{ component }} packages are installed
      yum: 
        name: "{{ item }}" 
        state: latest 
      with_items: packages 

    - name: ensure {{ component }} services are stopped
      service:
        name: "{{ item }}"
        state: stopped
      with_items: services

    - name: update memcached.conf from template
      template:
        src: templates/etc/memcached.conf
        dest: /etc/memcached.conf
        owner: root
        group: root
        mode: 0644

    - name: update local_settings.py from template
      template:
        src: templates/etc/openstack-dashboard/local_settings.py
        dest: /etc/openstack-dashboard/local_settings.py
        owner: root
        group: root
        mode: 0644

    - name: ensure {{ component }} services are started and enabled
      service:
        name: "{{ item }}"
        state: restarted
        enabled: yes
      with_items: services
